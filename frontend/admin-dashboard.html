<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Fleet Management | Admin Portal</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Sora:wght@400;500;600;700&family=Space+Grotesk:wght@400;500;600&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="css/app.css" />
  </head>
    <body class="ui-body" data-page="admin">
      <div class="admin-layout">
        <aside class="admin-sidebar">
          <div class="admin-sidebar__brand">
            <span class="logo-pill">FleetOS</span>
            <strong>Portail Administrateur</strong>
            <p class="sidebar-note">Pilotez exploitants, conducteurs et alertes depuis un même espace.</p>
          </div>
          <nav class="admin-sidebar__menu" aria-label="Navigation administrateur">
            <ul class="admin-sidebar__nav">
              <li><a href="#resume">Vue d’ensemble</a></li>
              <li><a href="#usersBoard">Exploitants & Conducteurs</a></li>
              <li><a href="#fleetInsights">Parcs & Véhicules</a></li>
              <li><a href="#alertsBoard">Alertes & Incidents</a></li>
              <li><a href="#adminBoard">Administrateurs</a></li>
              <li><a href="#settings">Paramètres</a></li>
              <li><a href="dashboard.html">Vue opérateur</a></li>
            </ul>
          </nav>
          <button id="logoutBtn" class="ghost-button ghost-button--light admin-sidebar__logout">Déconnexion</button>
        </aside>

        <main class="admin-main">
          <header class="admin-topbar" id="resume">
            <div>
              <p class="eyebrow">Pilotage des comptes FleetOS</p>
              <h1 id="userEmail">Administrateur connecté</h1>
              <p>Supervisez les utilisateurs et la santé opérationnelle des parcs.</p>
              <ul id="roleBadges" class="role-badges"></ul>
            </div>
          </header>

          <section class="admin-metrics" data-visible-for="ROLE_ADMIN" hidden>
            <article class="admin-metric">
              <p>Exploitants inscrits</p>
              <h3 id="adminTotalCarriers">0</h3>
              <p class="stat-sub">Organisations actives</p>
            </article>
            <article class="admin-metric">
              <p>Conducteurs inscrits</p>
              <h3 id="adminTotalDrivers">0</h3>
              <p class="stat-sub">Profils terrain</p>
            </article>
            <article class="admin-metric">
              <p>Véhicules suivis</p>
              <h3 id="adminTotalVehicles">0</h3>
              <p class="stat-sub">Flotte déclarée</p>
            </article>
            <article class="admin-metric">
              <p>Alertes ouvertes</p>
              <h3 id="adminTotalAlerts">0</h3>
              <p class="stat-sub">Priorités en cours</p>
            </article>
            <article class="admin-metric">
              <p>Incidents aujourd’hui</p>
              <h3 id="adminTodayIncidents">0</h3>
              <p class="stat-sub">Signalements du jour</p>
            </article>
            <article class="admin-metric">
              <p>Taux de résolution</p>
              <h3 id="adminResolutionRate">0%</h3>
              <p class="stat-sub">Alertes clôturées</p>
            </article>
          </section>

          <section class="admin-card" id="fleetInsights" data-visible-for="ROLE_ADMIN" hidden>
            <header>
              <div>
                <p class="eyebrow">Vue d’ensemble</p>
                <h2>Activité des parcs</h2>
                <p class="field-note">Indicateurs issus des données de démonstration FleetOS.</p>
              </div>
            </header>
            <div class="insight-grid">
              <article class="panel chart-card">
                <div class="panel-head">
                  <p class="eyebrow">Alertes</p>
                  <h3>Ouvert vs clôturé</h3>
                </div>
                <div id="adminAlertsChart" class="chart chart--line" aria-live="polite"></div>
              </article>
              <article class="panel chart-card">
                <div class="panel-head">
                  <p class="eyebrow">Incidents</p>
                  <h3>Répartition par type</h3>
                </div>
                <div id="adminIncidentsChart" class="chart chart--bars" aria-live="polite"></div>
              </article>
              <article class="panel chart-card">
                <div class="panel-head">
                  <p class="eyebrow">Parcs</p>
                  <h3>Top exploitants par alertes</h3>
                </div>
                <div id="adminActivityChart" class="chart chart--bars" aria-live="polite"></div>
              </article>
            </div>
          </section>

          <section class="admin-card" id="alertsBoard" data-visible-for="ROLE_ADMIN" hidden>
            <header>
              <div>
                <p class="eyebrow">Alertes critiques</p>
                <h2>Suivi des priorités</h2>
              </div>
            </header>
            <div class="table-wrapper" role="region" aria-live="polite">
              <table>
                <thead>
                  <tr>
                    <th>Priorité</th>
                    <th>Véhicule</th>
                    <th>Exploitant</th>
                    <th>Date</th>
                  </tr>
                </thead>
                <tbody id="adminCriticalAlertsTable"></tbody>
              </table>
            </div>
          </section>

          <section class="admin-card" id="usersBoard" data-visible-for="ROLE_ADMIN" hidden>
            <header>
              <div>
                <p class="eyebrow">Comptes utilisateurs</p>
                <h2>Exploitants & Conducteurs</h2>
                <p class="field-note">Données issues de l’annuaire FleetOS.</p>
              </div>
              <div class="admin-card__actions">
                <button id="refreshUsersBtn" class="ghost-button">Actualiser</button>
              </div>
            </header>
            <p id="adminUsersStatus" class="status-text"></p>
            <div class="table-wrapper" role="region" aria-live="polite">
              <table>
                <thead>
                  <tr>
                    <th>ID</th>
                    <th>Utilisateur</th>
                    <th>Email</th>
                    <th>Rôles</th>
                    <th>Statut</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody id="adminUsersBody"></tbody>
              </table>
            </div>
          </section>

          <section class="admin-card" id="recentAccounts" data-visible-for="ROLE_ADMIN" hidden>
            <header>
              <div>
                <p class="eyebrow">Dernières créations</p>
                <h2>Comptes ajoutés récemment</h2>
              </div>
            </header>
            <div class="table-wrapper" role="region" aria-live="polite">
              <table>
                <thead>
                  <tr>
                    <th>ID</th>
                    <th>Utilisateur</th>
                    <th>Email</th>
                    <th>Rôles</th>
                  </tr>
                </thead>
                <tbody id="adminRecentAccountsBody"></tbody>
              </table>
            </div>
          </section>

          <section class="admin-card admin-card--stacked" id="adminBoard" data-visible-for="ROLE_ADMIN" hidden>
            <header>
              <div>
                <p class="eyebrow">Administrateurs</p>
                <h2>Création et pilotage des accès</h2>
                <p class="field-note">Seuls les administrateurs connectés peuvent activer ou suspendre des comptes.</p>
              </div>
              <div class="admin-card__actions">
                <button id="refreshAdminsBtn" class="ghost-button">Actualiser</button>
              </div>
            </header>
            <div class="admin-panels admin-panels--stacked">
              <article class="admin-card admin-card--sub">
                <h3>Créer un administrateur</h3>
                <p class="field-note">Complétez ce formulaire pour inviter un nouveau responsable FleetOS.</p>
                <form id="createAdminForm" class="form-grid form-grid--stacked">
                  <div class="form-field">
                    <label class="form-label" for="adminUsername">Nom d’utilisateur</label>
                    <input class="form-control" id="adminUsername" name="username" required placeholder="ex: fleet.supervisor" />
                  </div>
                  <div class="form-field">
                    <label class="form-label" for="adminEmail">Email</label>
                    <input class="form-control" id="adminEmail" name="email" type="email" required placeholder="admin@entreprise.com" />
                  </div>
                  <div class="form-field">
                    <label class="form-label" for="adminPassword">Mot de passe</label>
                    <input class="form-control" id="adminPassword" name="password" type="password" required minlength="8" />
                  </div>
                  <button class="primary-button" type="submit">Créer l’administrateur</button>
                </form>
                <p id="adminFormStatus" class="status-text" role="status" aria-live="polite"></p>
              </article>

              <article class="admin-card admin-card--sub">
                <header>
                  <div>
                    <h3>Liste des administrateurs</h3>
                    <p class="field-note">Vue dédiée aux rôles critiques.</p>
                  </div>
                  <p id="adminOnlyStatus" class="status-text"></p>
                </header>
                <div class="admin-admins__header">
                  <p>Total administrateurs : <strong id="adminOnlyCount">0</strong></p>
                </div>
                <div class="table-wrapper" role="region" aria-live="polite">
                  <table>
                    <thead>
                      <tr>
                        <th>ID</th>
                        <th>Utilisateur</th>
                        <th>Email</th>
                        <th>Statut</th>
                      </tr>
                    </thead>
                    <tbody id="adminOnlyBody"></tbody>
                  </table>
                </div>
              </article>
            </div>
          </section>

          <section class="admin-card" id="settings" data-visible-for="ROLE_ADMIN" hidden>
            <header>
              <div>
                <p class="eyebrow">Paramètres</p>
                <h2>Activation & suspension</h2>
                <p class="field-note">Utilisez les actions des tableaux pour ajuster les accès utilisateurs.</p>
              </div>
            </header>
            <p>Les changements sont appliqués instantanément auprès des exploitants et conducteurs.</p>
          </section>
        </main>
      </div>

      <div id="adminToast" class="admin-toast" role="status" aria-live="polite" hidden></div>

      <script type="module" src="js/dashboard.js"></script>
    </body>
</html>
