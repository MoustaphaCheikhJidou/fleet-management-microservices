server {
  listen 80;
  server_name _;
  root /usr/share/nginx/html;
  index index.html;
  include /etc/nginx/mime.types;
  default_type application/octet-stream;
  types {
    text/css css;
    application/javascript js mjs;
    application/json json;
    text/html html;
    image/svg+xml svg;
  }
  add_header X-Content-Type-Options nosniff;
  resolver 127.0.0.11 ipv6=off;

  location /vendor/ {
    alias /usr/share/nginx/html/vendor/;
    try_files $uri =404;
  }

  location /src/ {
    alias /usr/share/nginx/html/src/;
    add_header Cache-Control "no-store, must-revalidate";
    try_files $uri =404;
  }

  location /api/ {
    # Route through gateway service without exposing host:port in client URLs
    set $gateway_host gateway-service;
    set $gateway_port 8080;
    proxy_pass http://$gateway_host:$gateway_port;
    proxy_set_header Host $host;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
  }

  location / {
    try_files $uri /index.html;
  }
}
